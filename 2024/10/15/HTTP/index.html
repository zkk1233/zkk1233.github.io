<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>HTTP | 无言の小屋</title><meta name="author" content="hackun"><meta name="copyright" content="hackun"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="HTTPHTTP概述HTTP 是一种用作获取诸如 HTML 文档这类资源的协议（TTP 是一种应用层的协议，通过 TCP 或 TLS（一种加密过的 TCP 连接）来发送）。它是 Web 上进行任何数据交换的基础，也是一种客户端—服务器（client-server）协议 HTTP请求包的结构请求行URL（统一资源定位符）是因特网中的唯一资源的地址。它是浏览器用于检索已发布资源（例如 HTML 页面、">
<meta property="og:type" content="article">
<meta property="og:title" content="HTTP">
<meta property="og:url" content="https://zkk1233.github.io/2024/10/15/HTTP/index.html">
<meta property="og:site_name" content="无言の小屋">
<meta property="og:description" content="HTTPHTTP概述HTTP 是一种用作获取诸如 HTML 文档这类资源的协议（TTP 是一种应用层的协议，通过 TCP 或 TLS（一种加密过的 TCP 连接）来发送）。它是 Web 上进行任何数据交换的基础，也是一种客户端—服务器（client-server）协议 HTTP请求包的结构请求行URL（统一资源定位符）是因特网中的唯一资源的地址。它是浏览器用于检索已发布资源（例如 HTML 页面、">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zkk1233.github.io/img/hh.jpg">
<meta property="article:published_time" content="2024-10-15T09:57:41.057Z">
<meta property="article:modified_time" content="2025-01-30T02:42:34.112Z">
<meta property="article:author" content="hackun">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zkk1233.github.io/img/hh.jpg"><link rel="shortcut icon" href="/img/hh.jpg"><link rel="canonical" href="https://zkk1233.github.io/2024/10/15/HTTP/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        if (name && globalFn[key][name]) return
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'HTTP',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-30 10:42:34'
}</script><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4824591_9azdcw4711i.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/icat.css"><link rel="stylesheet" href="/css/nav_menu.css"><link rel="stylesheet" href="/css/cursor.css"></head><body><canvas id="bubble_canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:999999;pointer-events:none"></canvas><link rel="stylesheet" href="/css/pace.main.css"><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><link rel="stylesheet" href="/css/wave_style.css"><link rel="stylesheet" href="/css/music.css"><meta name="generator" content="Hexo 7.3.0"><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img" style="background-image:url(/img/hh.jpg);background-repeat: no-repeat;background-position:center;"></div><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {

    document.body.style.overflow = 'hidden';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
preloader.initLoading()
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg" style="background-image: url(/img/bb.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="/img/hh.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-earth"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw iconfont icon-galaxy"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-satellite"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-moon"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-mars"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-keji"></i><span> 友人帐</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/gg.jpg);"><nav id="nav"><span id="blog-info"><a href="/" title="无言の小屋"><span class="site-name">无言の小屋</span></a></span><div class="mask-name-container"><center id="name-container"><a id="page-name" href="javascript:btf.scrollToDest(0, 500)">PAGE_NAME</a></center></div><div id="menus"><div class="nav-button" id="nav-totop"><a class="totopbtn"></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-earth"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw iconfont icon-galaxy"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-satellite"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-moon"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-mars"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw iconfont icon-keji"></i><span> 友人帐</span></a></div></div></div><div id="nav-right"><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">HTTP</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-10-15T09:57:41.057Z" title="发表于 2024-10-15 17:57:41">2024-10-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-30T02:42:34.112Z" title="更新于 2025-01-30 10:42:34">2025-01-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">10.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>37分钟</span></span><span class="post-meta-separator">|</span><span id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/10/15/HTTP/#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><div id="postchat_postcontent"><h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><h2 id="HTTP概述"><a href="#HTTP概述" class="headerlink" title="HTTP概述"></a>HTTP概述</h2><p><strong>HTTP</strong> 是一种用作获取诸如 HTML 文档这类资源的协议（TTP 是一种应用层的协议，通过 TCP 或 TLS（一种加密过的 TCP 连接）来发送）。它是 Web 上进行任何数据交换的基础，也是一种客户端—服务器（client-server）协议</p>
<h2 id="HTTP请求包的结构"><a href="#HTTP请求包的结构" class="headerlink" title="HTTP请求包的结构"></a>HTTP请求包的结构</h2><h3 id="请求行"><a href="#请求行" class="headerlink" title="请求行"></a>请求行</h3><h4 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h4><p>（统一资源定位符）是因特网中的唯一资源的地址。它是浏览器用于检索已发布资源（例如 HTML 页面、CSS 文档、图像等）的关键机制之一</p>
<h5 id="URL基本内容"><a href="#URL基本内容" class="headerlink" title="URL基本内容"></a>URL基本内容</h5><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651760.png" style="zoom:200%;">

<h6 id="协议（scheme）"><a href="#协议（scheme）" class="headerlink" title="协议（scheme）"></a>协议（scheme）</h6><p> HTTPS 、 HTTP、FTP</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651761.png"></p>
<h6 id="权威（authority）"><a href="#权威（authority）" class="headerlink" title="权威（authority）"></a>权威（authority）</h6><p>权威包括域名（例如 <code>www.example.com</code>）和端口（<code>80</code>），由冒号分隔</p>
<p>注：邮件客户端（<code>mailto:foobar</code>）不使用权威（其包含方案）</p>
<h6 id="路径（Path）"><a href="#路径（Path）" class="headerlink" title="路径（Path）"></a>路径（Path）</h6><p><code>/path/to/myfile.html</code> 、<code>/index.html</code>是 Web 服务器上资源的路径</p>
<h6 id="参数（Parameters）"><a href="#参数（Parameters）" class="headerlink" title="参数（Parameters）"></a>参数（Parameters）</h6><p><code>?key1=value1&amp;key2=value2</code> 是提供给 Web 服务器的额外参数(参数是用 <code>&amp;</code> 符号分隔的键/值对列表)</p>
<h6 id="锚点（Anchor）"><a href="#锚点（Anchor）" class="headerlink" title="锚点（Anchor）"></a>锚点（Anchor）</h6><p><code>#SomewhereInTheDocument</code> 是资源本身的另一部分的锚点</p>
<p>锚点表示资源中的一种“书签”，给浏览器显示位于该“加书签”位置的内容的方向</p>
<p><strong>#</strong> 后面的部分（也称为<strong>片段标识符</strong>）不会随请求被发送到服务器</p>
<h5 id="一些URL"><a href="#一些URL" class="headerlink" title="一些URL"></a>一些URL</h5><p>数据URL：以 <code>data:</code> 方案为前缀的 URL，允许内容创建者在文档中嵌入小文件</p>
<p>注：URL 编码使用 “%” 其后跟随两位的十六进制数来替换非 ASCII 字符。</p>
<p>URL 不能包含空格。URL 编码通常使用 + 来替换空格。</p>
<h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><h4 id="请求方式："><a href="#请求方式：" class="headerlink" title="请求方式："></a>请求方式：</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651762.png"></p>
<h4 id="GET和POST"><a href="#GET和POST" class="headerlink" title="GET和POST"></a>GET和POST</h4><h5 id="get-请求"><a href="#get-请求" class="headerlink" title="get 请求"></a>get 请求</h5><p>GET 请求<strong>主要用于从服务器获取数据</strong>，常用于获取<strong>静态资源</strong>（网页、图片、文件等）<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651763.png"></p>
<p>get请求的参数传递方式</p>
<p>在 HTTP 请求中，GET 请求可以通过 URL 参数或者请求体的方式传递参数。</p>
<p>URL 参数：GET 请求可以通过 URL 中指定的 key-value 形式传递参数。</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/search?q=test&amp;page=2</span><br></pre></td></tr></tbody></table></figure>

<p>？后 key= value</p>
<h5 id="post请求"><a href="#post请求" class="headerlink" title="post请求"></a>post请求</h5><p>POST 请求<strong>主要用于向服务器提交数据，通常用于创建、更新或删除资源</strong>、上传文件、发送 JSON 数据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651764.png"></p>
<p>post请求的参数传递方式：URL 参数和请求体。</p>
<p>1.URL 参数：POST 请求可以通过 URL 中指定的 key-value 形式传递参数。例如，在访问如下 URL 时：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/search?q=test&amp;page=2</span><br></pre></td></tr></tbody></table></figure>

<p>2.请求体（仅适用于 POST、PUT、PATCH 请求）：当 POST、PUT 或 PATCH 请求的 URL 中没有指定参数时，参数会被放置在请求体中。请求体中的数据可以是表单数据、JSON 数据等。例如，使用 POST 请求将 JSON 数据发送到如下 URL 时：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/users</span><br></pre></td></tr></tbody></table></figure>

<p>请求体中的 JSON 数据如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line"> "name": "John Doe",</span><br><span class="line"> "email": "john.doe@example.com"</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h5 id="get和post区别"><a href="#get和post区别" class="headerlink" title="get和post区别"></a>get和post区别</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651765.png"></p>
<h5 id="get-和-post-请求的使用场景"><a href="#get-和-post-请求的使用场景" class="headerlink" title="get 和 post 请求的使用场景"></a>get 和 post 请求的使用场景</h5><h6 id="get"><a href="#get" class="headerlink" title="get"></a>get</h6><ul>
<li>获取数据：GET 请求适合用于从服务器获取数据，例如获取网页内容、查询数据库、获取资源文件等。由于 GET 请求的参数会显示在 URL 中，因此它适用于不需要保密的参数传递。</li>
<li>缓存友好：GET 请求的响应可以被缓存，这对于一些静态资源的获取非常有益，可以提高性能和减少服务器负载。</li>
<li>链接导航：GET 请求可以用于在浏览器中进行链接导航，通过在 URL 中传递参数来指定要导航到的页面或资源。</li>
</ul>
<h6 id="post"><a href="#post" class="headerlink" title="post"></a>post</h6><ul>
<li><p>提交数据：POST 请求适合用于向服务器提交数据，例如提交表单、上传文件等。由于 POST 请求的参数不会显示在 URL 中，因此它<strong>适用于传递敏感数据或大量参数</strong>。</p>
</li>
<li><p>创建资源：POST 请求可以用于在服务器上创建新的资源，例如创建新的用户、发布新的文章等。</p>
</li>
<li><p>执行非幂等操作：POST 请求是非幂等的，意味着多次发送相同的 POST 请求可能会产生不同的结果。这适用于一些需要执行不可重复操作的场景，例如订单支付、密码修改等。</p>
<p>加键值对时get在url中？a=1   post在请求体中a=11</p>
</li>
</ul>
<h3 id="请求头及其内容"><a href="#请求头及其内容" class="headerlink" title="请求头及其内容"></a>请求头及其内容</h3><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651766.png">

<h4 id="常见的请求头及作用"><a href="#常见的请求头及作用" class="headerlink" title="常见的请求头及作用"></a>常见的请求头及作用</h4><p>Host，Referer，User-Agent，Cookie，Content-Type，X-Forwarded-For</p>
<p><em>注：POST 请求（包含 HTML 表单数据）需要主体</em></p>
<p><em>主体大致可分为两类：</em></p>
<p>*单一资源（Single-resource）主体，由一个单文件组成。该类型的主体由两个标头定义：Content-Type和Content-Length</p>
<p><em>多资源（Multiple-resource）主体，由多部分主体组成，每一部分包含不同的信息位。通常是和 HTML 表单连系在一起。</em></p>
<ol>
<li><p><strong>Host</strong>：指定请求的服务器的域名和端口号。</p>
</li>
<li><p><strong>User-Agent</strong>：包含发出请求的用户代理（浏览器）的信息，可用来浏览器伪造。</p>
<p>一个典型的 <code>User-Agent</code> 字符串可能看起来像这样：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36</span><br></pre></td></tr></tbody></table></figure>

<p>这个字符串包含了以下信息：</p>
<ul>
<li><strong>浏览器</strong>：Mozilla/5.0</li>
<li><strong>操作系统</strong>：Windows NT 10.0</li>
<li><strong>平台</strong>：Win64; x64</li>
<li><strong>浏览器核心</strong>：AppleWebKit/537.36</li>
<li><strong>浏览器名称</strong>：Chrome</li>
<li><strong>浏览器版本</strong>：58.0.3029.110</li>
<li><strong>渲染引擎</strong>：Safari/537.36</li>
</ul>
</li>
<li><p><strong>Accept</strong>：指定客户端能够处理的媒体类型。</p>
</li>
<li><p><strong>Accept-Language</strong>：指定客户端偏好的语言。</p>
</li>
<li><p><strong>Accept-Encoding</strong>：指定客户端能够处理的压缩算法。</p>
</li>
<li><p><strong>Authorization</strong>：用于身份验证的凭证。</p>
<blockquote>
<p>[!IMPORTANT]</p>
<h4 id="HTTP-基本认证"><a href="#HTTP-基本认证" class="headerlink" title="HTTP 基本认证"></a>HTTP 基本认证</h4><p>通过在请求头 (<code>Authorization</code> 头) 中发送用户名和密码来进行身份验证。用户名和密码（用户名：密码）会经过 <strong>Base64 编码</strong>，但 <strong>不会加密</strong></p>
<p><strong>客户端提供用户名和密码</strong>，并在 <code>Authorization</code> 头中发送：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Basic &lt;Base64编码的用户名:密码&gt;</span><br></pre></td></tr></tbody></table></figure>


</blockquote>
</li>
<li><p><strong>Cookie</strong>：Cookie 是一种服务器发送到用户浏览器并保存在本地的数据。它用于跟踪和识别用户会话，存储用户的偏好设置。</p>
<p>基本概念</p>
<p>会话Cookie：只在浏览器会话期间有效，当用户关闭浏览器时，这些Cookie就会被删除。浏览器定义了“当前会话”结束的时间，一些浏览器重启时会使用<em>会话恢复</em>。这可能导致会话 cookie 无限延长。</p>
<p>持久Cookie：在过期时间（<code>Expires</code>）指定的日期或有效期（<code>Max-Age</code>）指定的一段时间后被删除。</p>
<p>示例</p>
<p>假设服务器想要设置一个Cookie，其内容如下：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: sessionId=abc123; Expires=Wed, 09 Jun 2024 10:18:14 GMT; Domain=example.com; Path=/; Secure; HttpOnly; SameSite=Lax</span><br></pre></td></tr></tbody></table></figure>

<p>在这个例子中：</p>
<p><code>sessionId=abc123</code> 是Cookie的名称-值对（存储在Cookie中的数据）</p>
<p><code>Expires=Wed, 09 Jun 2024 10:18:14 GMT</code> 定义了Cookie的过期时间。<code>ax-Age</code>属性指定一个相对于创建时的时间长度（以秒为单位）</p>
<p><code>Domain=example.com</code> 指定了Cookie的有效域名（哪些域名下的页面请求可以包含这个Cookie）如果未指定，默认为创建Cookie的服务器的域名</p>
<p><code>Path=/</code> 指定了Cookie的有效路径。</p>
<p><code>Secure</code> 属性表示Cookie仅通过HTTPS发送。</p>
<p><code>HttpOnly</code> 属性表示Cookie不能被客户端脚本（如JavaScript）访问。</p>
<blockquote>
<p>[!CAUTION]</p>
<p>XSS 攻击是一种常见的攻击方式，攻击者通过向 Web 页面注入恶意的 JavaScript 代码来窃取用户数据。使用 <code>HttpOnly</code> 标记的 Cookie 可以防止恶意 JavaScript 代码通过 <code>document.cookie</code> 或其他方式获取敏感数据（如会话 Cookie）</p>
<p>但它并不能防止 Cookie 被服务器端访问，攻击者如果能够获得服务器端的访问权限（如 SQL 注入、服务器配置错误等）或进行CSRF（跨站请求伪造）攻击，仍然有可能窃取 Cookie</p>
<p>因此，它需要与其他安全措施（如 <code>Secure</code>、<code>SameSite</code>）结合使用，以提供全面的安全防护</p>
</blockquote>
<p><code>SameSite=Lax</code> 属性表示在跨站请求时，Cookie不会随请求发送，除非请求是同站的。</p>
</li>
<li><p><strong>Content-Length</strong>：请求体的长度。</p>
</li>
<li><p><strong>Content-Type</strong>：指定资源的媒体类型（ MIME 类型）（<strong>媒体类型</strong>（也通常称为<strong>多用途互联网邮件扩展</strong>或 <strong>MIME</strong> 类型）是一种标准，用来表示文档、文件或一组数据的性质和格式），告诉接收方如何处理传输的数据</p>
<blockquote>
<p>[!WARNING]</p>
<p> 浏览器通常使用 MIME 类型<em>而不是文件扩展名</em>来决定如何处理 URL，因此 Web 服务器在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a> 响应标头中添加正确的 MIME 类型非常重要。如果配置不正确，浏览器可能会曲解文件内容，网站将无法正常工作，并且下载的文件也可能被错误处理</p>
</blockquote>
<p>以下是一些常见的 <code>Content-Type</code> 值及其对应的数据格式：</p>
<ol>
<li><p><strong>文本类型</strong></p>
<ul>
<li><p><code>text/html</code>：HTML 文档。</p>
<blockquote>
<p>[!CAUTION]</p>
<p>如果需要 XML 的严格解析规则、<code>&lt;![CDATA[...]]&gt;</code>(<em>在 XML 中，所有的字符数据默认都会被解析，并且需要处理特殊字符（比如 <code>&amp;</code> 会变成 <code>&amp;</code>，<code>&lt;</code> 会变成 <code>&lt;</code>）。但是，如果你使用 <code>CDATA</code>，则该部分中的所有内容都会被当作普通文本处理，直到遇到 <code>]]&gt;</code>，这时 CDATA 部分结束</em>)或 HTML/SVG/MathML 命名空间以外的元素，请使用 application/xml 或 application/xhtml+xml</p>
</blockquote>
</li>
<li><p><code>text/plain</code>：纯文本，文本文件的默认值。即使它其实意味着<em>未知的文本文件</em>，但浏览器认为是可以直接展示的。</p>
<blockquote>
<p>[!CAUTION]</p>
<p>text/plain 并不意味“任何种类的文本数据”。如果浏览器期待的是某种特定的文本数据，很可能不会将其视为匹配。具体来说，如果从声明 CSS 文件的 <code>&lt;link&gt;</code> 元素中下载了一个 text/plain 文件，那么如果提供的是 text/plain类型，就不会将其识别为有效的 CSS 文件。CSS MIME 类型需要使用 text/css</p>
</blockquote>
</li>
<li><p><code>text/css</code>：层叠样式表（CSS），在网页中要被解析为 CSS 的任何 CSS 文件<strong>必须</strong>指定 MIME 为 <code>text/css</code></p>
</li>
<li><p><code>text/javascript</code>：JavaScript 代码（已废弃，应使用 <code>application/javascript</code>）。</p>
</li>
</ul>
</li>
<li><p><strong>图像类型</strong></p>
<ul>
<li><code>image/gif</code>：图形交换格式（GIF）</li>
<li><code>image/jpeg</code>：联合图像专家小组图片（JPEG）</li>
<li><code>image/png</code>：便携式网络图形（PNG）</li>
<li><code>image/svg+xml</code>：可缩放矢量图形（SVG）</li>
<li><code>image/webp</code>：Web 图像格式（WEBP）</li>
<li><code>image/apng</code>：动画便携式网络图形（APNG）</li>
<li><code>image/avif</code>：AV1 图像文件格式（AVIF）</li>
</ul>
</li>
<li><p><strong>音频和视频类型</strong></p>
<ul>
<li><code>audio/mpeg</code>：MPEG 音频。</li>
<li><code>video/mp4</code>：MP4 视频。</li>
<li><code>audio/ogg</code>：Ogg 音频。</li>
<li><code>video/ogg</code>：Ogg 视频。</li>
<li><code>video/webm</code>: WebM格式的视频。</li>
</ul>
</li>
<li><p><strong>应用程序类型</strong></p>
<ul>
<li><code>application/json</code>：JSON 数据。</li>
<li><code>application/xml</code>：XML 数据。</li>
<li><code>application/pdf</code>：PDF 文档。</li>
<li><code>application/zip</code>：ZIP 压缩文件。</li>
<li><code>application/javascript</code>：JavaScript 代码（现代浏览器推荐使用）。</li>
</ul>
</li>
<li><p><strong>多部分类型</strong></p>
<ul>
<li><code>multipart/form-data</code>：用于表单数据的传输，允许在单个请求中发送多个文件和字段。这通常用于文件上传和多值数据传输，可用于HTML表单从浏览器发送信息给服务器</li>
<li><code>multipart/byteranges</code>：用于定义多个字节范围，通常用于视频流或大文件下载</li>
</ul>
</li>
<li><p><strong>其他类型</strong></p>
<ul>
<li><code>application/octet-stream</code>：这是二进制文件的默认值。由于这意味着<em>未知的二进制文件</em>，浏览器一般不会自动执行或询问执行。浏览器将这些文件视为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Disposition"><code>Content-Disposition</code></a> 标头被设置为 <code>attachment</code> 一样，并弹出“另存为”对话框</li>
<li><code>application/x-www-form-urlencoded</code>：用于表单数据的传输，通常用于 GET 和 POST 请求。</li>
</ul>
</li>
<li><p><strong>字符编码</strong></p>
<ul>
<li>许多 <code>Content-Type</code> 值可以包含字符编码信息，如 <code>text/html; charset=utf-8</code>，这指定了使用 UTF-8 编码的 HTML 文档。</li>
</ul>
</li>
</ol>
<blockquote>
<p>[!IMPORTANT]</p>
<p>在 HTML 表单中，<code>enctype</code> 是一个属性，用于指定在提交表单时数据的编码类型。它决定了表单数据在发送到服务器时的格式在 HTML 表单中，<code>enctype</code> 是一个属性，用于指定在提交表单时数据的编码类型。它决定了表单数据在发送到服务器时的格式</p>
<p><strong>application/x-www-form-urlencoded</strong>（默认）：适用于提交常规文本数据，简单的表单提交。</p>
<p><strong>multipart/form-data</strong>：适用于<strong>上传文件</strong>时的表单提交，当表单包含文件上传时，一定要使用 <code>multipart/form-data</code>，否则文件将无法正确上传</p>
<p><strong>text/plain</strong>：以纯文本形式提交数据，每对 <code>name=value</code> 由换行符分隔。</p>
</blockquote>
</li>
<li><p><strong>Referer</strong>：指示请求来源的页面URL（用户是从哪个页面点击链接到达当前请求的页面的），可用来服务器伪造 <a target="_blank" rel="noopener" href="https://www.xxxx.com,这个头部字段通常用于分析流量来源、防止csrf(跨站请求伪造)攻击以及跟踪用户行为/">https://www.xxxx.com，这个头部字段通常用于分析流量来源、防止CSRF（跨站请求伪造）攻击以及跟踪用户行为</a></p>
<p>示例</p>
<p>假设你访问了一个网站 <code>http://example.com/page1</code>，然后从该页面点击链接跳转到 <code>http://example.com/page2</code>，浏览器在请求 <code>page2</code> 时，通常会将以下头部添加到请求中：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Referer: http://example.com/page1</span><br></pre></td></tr></tbody></table></figure>

<p>假设用户从页面 <code>https://www.example.com/page1.html</code> 点击一个链接，跳转到 <code>https://www.example.com/page2.html</code>，那么在请求 <code>page2.html</code> 时，HTTP请求的 <code>Referer</code> 头部可能如下：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /page2.html HTTP/1.1</span><br><span class="line">Host: www.example.com</span><br><span class="line">Referer: https://www.example.com/page1.html</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p>11.<strong>X-Forwarded-For</strong>:用于在HTTP请求经过代理服务器或负载均衡器时保留原始客户端的IP地址信息，可用于修改ip 如127.0.0.1</p>
<p><code>X-Forwarded-For</code>头部字段的格式如下：</p>
<figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: &lt;client-IP&gt;, &lt;proxy1-IP&gt;, &lt;proxy2-IP&gt;, ...</span><br></pre></td></tr></tbody></table></figure>

<p>其中，列表中的第一个IP地址（<code>&lt;client-IP&gt;</code>）是客户端的真实IP地址，随后的IP地址表示请求依次经过的代理服务器的IP地址。</p>
<h2 id="HTTP响应包的结构"><a href="#HTTP响应包的结构" class="headerlink" title="HTTP响应包的结构"></a>HTTP响应包的结构</h2><p>响应行</p>
<p>HTTP/1.1 404 Not Found</p>
<ol>
<li><em>协议版本</em>，通常为 <code>HTTP/1.1</code>。</li>
<li><em>状态码</em>（status code），表明请求是成功或失败。常见的状态码是 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/200"><code>200</code></a>（OK。请求成功）、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/404"><code>404</code></a> （Not Found。服务器无法找到请求的资源）或<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/301"><code>301</code></a>（Moved Permanently。请求资源的 URI 已被改变）</li>
<li><em>状态文本</em>（status text）。一个简短的，纯粹的信息，通过状态码的文本描述，帮助人们理解该 HTTP 消息</li>
</ol>
<p>响应头</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20241224235651767.png"></p>
<p>通用标头（General header），例如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Via"><code>Via</code></a>，适用于整个消息。</p>
<p>响应标头（Response header），例如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Vary"><code>Vary</code></a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Ranges"><code>Accept-Ranges</code></a>，提供有关服务器的其他信息，这些信息不适合状态行。</p>
<p>表示标头（Representation header），例如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a> 描述了消息数据的原始格式和应用的任意编码（仅在消息有主体时才存在）</p>
<ol>
<li><strong>Content-Type</strong>：响应体的媒体类型。</li>
<li><strong>Content-Length</strong>：响应体的长度。</li>
<li><strong>Cache-Control</strong>：控制响应的缓存行为。</li>
<li><strong>Expires</strong>：指定资源到期的时间。</li>
<li><strong>Set-Cookie</strong>：设置客户端的Cookie。</li>
<li><strong>Location</strong>：用于重定向的URL。</li>
<li><strong>Server</strong>：包含服务器软件的信息。</li>
<li><strong>WWW-Authenticate</strong>：用于HTTP认证的挑战。</li>
<li><strong>Last-Modified</strong>：资源最后修改的时间。</li>
<li><strong>ETag</strong>：资源的特定版本的标识符。</li>
</ol>
<h2 id="HTTP缓存"><a href="#HTTP缓存" class="headerlink" title="HTTP缓存"></a>HTTP缓存</h2><p>HTTP 缓存会存储与请求关联的响应，并将存储的响应复用于后续请求</p>
<h3 id="私有缓存"><a href="#私有缓存" class="headerlink" title="私有缓存"></a>私有缓存</h3><p>绑定到<strong>特定</strong>客户端的缓存——通常是浏览器缓存</p>
<p>如果响应包含个性化内容并且你只想将响应存储在私有缓存中，则必须指定 <code>private</code> 指令</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: private</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>[!CAUTION]</p>
<p>如果响应具有 <code>Authorization</code> 标头，则不能将其存储在私有缓存（或共享缓存，除非 Cache-Control 指定的是 <code>public</code>）中</p>
</blockquote>
<blockquote>
<p>[!NOTE]</p>
<p> <code>public</code> 值具有使响应可存储的效果，只有在设置了 <code>Authorization</code> 标头时需要存储响应时才应使用 <code>public</code> 指令。否则不需要，因为只要给出了 <code>max-age</code>，响应就会存储在共享缓存中。</p>
</blockquote>
<h3 id="共享缓存"><a href="#共享缓存" class="headerlink" title="共享缓存"></a>共享缓存</h3><p>位于客户端和服务器之间，可以存储能在用户之间共享的响应</p>
<h4 id="代理缓存"><a href="#代理缓存" class="headerlink" title="代理缓存"></a>代理缓存</h4><p>除了访问控制的功能外，一些代理还实现了缓存以减少网络流量</p>
<h4 id="托管缓存"><a href="#托管缓存" class="headerlink" title="托管缓存"></a>托管缓存</h4><p>由服务开发人员明确部署，以降低源服务器负载并有效地交付内容，包括反向代理、CDN 和 service worker 与缓存 API 的组合</p>
<blockquote>
<p>[!CAUTION]</p>
<p>HTTP 缓存规范本质上没有定义显式删除缓存的方法——但是使用托管缓存，可以通过仪表板操作、API 调用、重新启动等实时删除已经存储的响应</p>
</blockquote>
<h3 id="启发式缓存"><a href="#启发式缓存" class="headerlink" title="启发式缓存"></a>启发式缓存</h3><p>HTTP 旨在尽可能多地缓存，因此即使没有给出 <code>Cache-Control</code>，如果满足某些条件，响应也会被存储和重用</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 1024</span><br><span class="line">Date: Tue, 22 Feb 2022 22:22:22 GMT</span><br><span class="line">Last-Modified（最后修改时间）: Tue, 22 Feb 2021 22:22:22 GMT</span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">…</span><br></pre></td></tr></tbody></table></figure>

<p>采取以上响应。此回复最后一次更新是在 1 年前</p>
<h3 id="基于-age-的缓存策略"><a href="#基于-age-的缓存策略" class="headerlink" title="基于 age 的缓存策略"></a>基于 age 的缓存策略</h3><p>存储的 HTTP 响应有两种状态：<strong>fresh</strong> 和 <strong>stale</strong>。<em>fresh</em> 状态通常表示响应仍然有效，可以重复使用，而 <em>stale</em> 状态表示缓存的响应已经过期</p>
<p>确定响应何时是 fresh 的和何时是 stale 的标准是 <strong>age</strong>（在 HTTP/1.0 中，有效期是通过 <code>Expires</code> 标头来指定的，在 HTTP/1.1 中，<code>Cache-Control</code> 采用了 <code>max-age</code>——用于指定经过的时间）</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 1024</span><br><span class="line">Date: Tue, 22 Feb 2022 22:22:22 GMT</span><br><span class="line">Cache-Control: max-age=604800</span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">…</span><br></pre></td></tr></tbody></table></figure>

<p>当响应存储在共享缓存中时，有必要通知客户端响应的 age。，如果共享缓存将响应存储了一天，则共享缓存将向后续客户端请求发送以下响应</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 1024</span><br><span class="line">Date: Tue, 22 Feb 2022 22:22:22 GMT</span><br><span class="line">Cache-Control: max-age=604800</span><br><span class="line">Age: 86400</span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">…</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Vary响应"><a href="#Vary响应" class="headerlink" title="Vary响应"></a>Vary响应</h3><p>区分响应的方式本质上是基于它们的 URL</p>
<p>在 <code>Vary</code> 标头的值中添加“<code>Accept-Language</code>”，根据语言单独缓存响应</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vary: Accept-Language</span><br></pre></td></tr></tbody></table></figure>

<p>这会导致缓存基于响应 URL 和 <code>Accept-Language</code>请求标头的组合进行键控</p>
<h3 id="验证响应"><a href="#验证响应" class="headerlink" title="验证响应"></a>验证响应</h3><p>验证是通过使用包含 <code>If-Modified-Since</code> 或 <code>If-None-Match</code> 请求标头的<strong>条件请求</strong>完成的</p>
<h4 id="If-Modified-Since"><a href="#If-Modified-Since" class="headerlink" title="If-Modified-Since"></a>If-Modified-Since</h4><p>下面的请求显示客户端发送带有 <code>If-Modified-Since</code> 请求标头的请求，以询问服务器自指定时间以来是否有任何的改变</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Accept: text/html</span><br><span class="line">If-Modified-Since: Tue, 22 Feb 2022 22:00:00 GMT</span><br></pre></td></tr></tbody></table></figure>

<p>如果内容自指定时间以来没有更改，服务器将响应 <code>304 Not Modified</code></p>
<h4 id="ETag-If-None-Match"><a href="#ETag-If-None-Match" class="headerlink" title="ETag/If-None-Match"></a>ETag/If-None-Match</h4><p>如果 <code>ETag</code> 标头使用了 hash 值，<code>index.html</code> 资源的 hash 值是 <code>deadbeef</code>，响应如下</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 1024</span><br><span class="line">Date: Tue, 22 Feb 2022 22:22:22 GMT</span><br><span class="line">ETag: "deadbeef"</span><br><span class="line">Cache-Control: max-age=3600</span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">…</span><br></pre></td></tr></tbody></table></figure>

<p>如果该响应是陈旧的，则客户端获取缓存响应的 <code>ETag</code> 响应标头的值，并将其放入 <code>If-None-Match</code> 请求标头中，以询问服务器资源是否已被修改</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Accept: text/html</span><br><span class="line">If-None-Match: "deadbeef"</span><br></pre></td></tr></tbody></table></figure>

<p>如果服务器为请求的资源确定的 <code>ETag</code> 标头的值与请求中的 <code>If-None-Match</code> 值相同，则服务器将返回 <code>304 Not Modified</code>，如果服务器确定请求的资源现在应该具有不同的 <code>ETag</code> 值，则服务器将其改为 <code>200 OK</code> 和资源的最新版本进行响应</p>
<blockquote>
<p>[!TIP]</p>
<p>可将ETag 和 Last-Modified 结合使用，ETag 提供高精度，而 Last-Modified 提供简单的时间戳，配合使用可以更高效地实现缓存控制</p>
</blockquote>
<h4 id="强制重新验证"><a href="#强制重新验证" class="headerlink" title="强制重新验证"></a>强制重新验证</h4><p>如果你不希望重复使用响应，而是希望始终从服务器获取最新内容，则可以使用 <code>no-cache</code> 指令强制验证</p>
<p>**<code>no-cache</code>**：允许缓存，不允许直接使用缓存的数据，每次使用缓存前都要向服务器验证数据的有效性</p>
<p>通过在响应中添加 <code>Cache-Control: no-cache</code> 以及 <code>Last-Modified</code> 和 <code>ETag</code>。如果请求的资源已更新，客户端将收到 <code>200 OK</code> 响应，否则，如果请求的资源尚未更新，则会收到 <code>304 Not Modified</code> 响应</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 1024</span><br><span class="line">Date: Tue, 22 Feb 2022 22:22:22 GMT</span><br><span class="line">Last-Modified: Tue, 22 Feb 2022 22:00:00 GMT</span><br><span class="line">ETag: deadbeef</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line">&lt;!doctype html&gt;</span><br><span class="line">…</span><br></pre></td></tr></tbody></table></figure>

<h3 id="不使用缓存"><a href="#不使用缓存" class="headerlink" title="不使用缓存"></a>不使用缓存</h3><p><code>no-cache</code> 指令不会阻止响应的存储，而是阻止在没有重新验证的情况下重用响应</p>
<p>使用 <code>private</code> 指令将使个性化响仅与特定客户端一起存储，而不会泄露给缓存的任何其他用户，但在这种情况下，即使设置了 <code>no-store</code>，也必须设置 <code>private</code></p>
<h3 id="重新加载和强制重新加载"><a href="#重新加载和强制重新加载" class="headerlink" title="重新加载和强制重新加载"></a>重新加载和强制重新加载</h3><h4 id="重新加载"><a href="#重新加载" class="headerlink" title="重新加载"></a>重新加载</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">If-None-Match: "deadbeef"</span><br><span class="line">If-Modified-Since: Tue, 22 Feb 2022 20:20:20 GMT</span><br></pre></td></tr></tbody></table></figure>

<p>请求中的 <code>max-age=0</code> 指令指定“重用 age 为 0 或更少的响应”——因此，中间存储的响应不会被重用</p>
<p>请求通过 <code>If-None-Match</code> 和 <code>If-Modified-Since</code> 进行验证</p>
<h4 id="强制重新加载"><a href="#强制重新加载" class="headerlink" title="强制重新加载"></a>强制重新加载</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: example.com</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br></pre></td></tr></tbody></table></figure>

<p>由于这不是带有 <code>no-cache</code> 的条件请求，因此你可以确定你会从源服务器获得 <code>200 OK</code></p>
<blockquote>
<p>[!CAUTION]</p>
<p>“no-cache”是正常重新加载的正确模式<br>fetch(“/“, { cache: “no-cache” });</p>
<p>“reload”是“强制重新加载”的正确模式<br>fetch(“/“, { cache: “reload” });</p>
</blockquote>
<h4 id="避免重新验证"><a href="#避免重新验证" class="headerlink" title="避免重新验证"></a>避免重新验证</h4><p>为了防止用户重新加载时，服务器在内容是不可变时，也会发送重新验证请求，<code>immutable</code> 指令可用于明确指示不需要重新验证</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cache-Control: max-age=31536000, immutable</span><br></pre></td></tr></tbody></table></figure>

<h2 id="HTTP重定向"><a href="#HTTP重定向" class="headerlink" title="HTTP重定向"></a>HTTP重定向</h2><p>HTTP 重定向是服务器告诉客户端（通常是浏览器）将请求重定向到另一个 URL 的一种机制。这通常发生在资源已被移动、网站结构发生更改或服务器需要将请求路由到不同位置的情况下</p>
<p>HTTP 重定向通过返回特定的状态码和 <code>Location</code> 响应头来实现，浏览器收到这些信息后，会自动发起对新的 URL 的请求</p>
<h3 id="永久重定向"><a href="#永久重定向" class="headerlink" title="永久重定向"></a>永久重定向</h3><p>表示原 URL 不应再被使用，而选用新的 URL 替换它</p>
<p>搜索引擎机器人、RSS 阅读器以及其他爬虫将更新资源原始的 URL</p>
<table>
<thead>
<tr>
<th align="left">状态码</th>
<th align="left">状态文本</th>
<th align="left">处理方法</th>
<th align="left">典型应用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>301</code></td>
<td align="left"><code>Moved Permanently</code></td>
<td align="left"><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a> 方法不会发生变更。其他方法有可能会变更为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a> 方法。</td>
<td align="left">网站重构。</td>
</tr>
<tr>
<td align="left"><code>308</code></td>
<td align="left"><code>Permanent Redirect</code></td>
<td align="left">方法和消息主体都不发生变化。</td>
<td align="left">使用用于非 GET 链接/操作重组网站。</td>
</tr>
</tbody></table>
<h3 id="临时重定向"><a href="#临时重定向" class="headerlink" title="临时重定向"></a>临时重定向</h3><p>有时候请求的资源无法从其标准地址访问，但是却可以从另外的地方访问。在这种情况下，可以使用临时重定向。在创建、更新或者删除资源的时候，临时重定向也可以用于显示临时性的进度页面</p>
<p>搜索引擎和其他爬虫不会记录新的、临时的 URL。</p>
<table>
<thead>
<tr>
<th align="left">状态码</th>
<th align="left">状态文本</th>
<th align="left">处理方法</th>
<th align="left">典型应用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>302</code></td>
<td align="left"><code>Found</code></td>
<td align="left"><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a> 方法不会发生变更。其他方法有可能会变更为 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a> 方法。[2]</td>
<td align="left">由于不可预见的原因该页面暂不可用。</td>
</tr>
<tr>
<td align="left"><code>303</code></td>
<td align="left"><code>See Other</code></td>
<td align="left"><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a> 方法不会发生变更，其他方法会<em>变更</em>为 <code>GET</code> 方法（消息主体丢失）。</td>
<td align="left">用于 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/PUT"><code>PUT</code></a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> 请求完成之后重定向，来防止由于页面刷新导致的操作的重复触发。</td>
</tr>
<tr>
<td align="left"><code>307</code></td>
<td align="left"><code>Temporary Redirect</code></td>
<td align="left">方法和消息主体都不发生变化。</td>
<td align="left">由于不可预见的原因该页面暂不可用。当站点支持非 <code>GET</code> 方法的链接或操作的时候，该状态码优于 302 状态码。</td>
</tr>
</tbody></table>
<h3 id="特殊重定向"><a href="#特殊重定向" class="headerlink" title="特殊重定向"></a>特殊重定向</h3><table>
<thead>
<tr>
<th align="left">状态码</th>
<th align="left">状态文本</th>
<th align="left">典型应用场景</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>300</code></td>
<td align="left"><code>Multiple Choice</code></td>
<td align="left">不常用：所有的选项在消息主体的 HTML 页面中列出。鼓励在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Link"><code>Link</code></a> 标头中加入机器可读的 <code>rel=alternate</code></td>
</tr>
<tr>
<td align="left"><code>304</code></td>
<td align="left"><code>Not Modified</code></td>
<td align="left">发送用于重新验证的条件请求。表示缓存的响应仍然是新的并且可以使用。</td>
</tr>
</tbody></table>
<h3 id="指向重定向的其他方式"><a href="#指向重定向的其他方式" class="headerlink" title="指向重定向的其他方式"></a>指向重定向的其他方式</h3><h4 id="HTML重定向机制"><a href="#HTML重定向机制" class="headerlink" title="HTML重定向机制"></a>HTML重定向机制</h4><p>用于将用户的请求从一个页面自动转到另一个页面</p>
<p>可以尝试在页面的<code>&lt;head&gt;</code>中添加一个<code>&lt;meta&gt;</code>元素，并将其 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta#http-equiv"><code>http-equiv</code></a> 属性的值设置为 <code>refresh</code>，可以告诉浏览器在指定的时间间隔后自动加载另一个页面。</p>
<p>该方法<strong>仅适用于 HTML 页面</strong>，然而并<strong>不能应用于图片或者其他类型的内容</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta http-equiv="Refresh" content="0(秒数); URL=http://example.com/(目标网址)" /&gt;</span><br><span class="line">&lt;/head&gt;</span><br></pre></td></tr></tbody></table></figure>

<h4 id="借助DOM的-JavaScript-重定向机制"><a href="#借助DOM的-JavaScript-重定向机制" class="headerlink" title="借助DOM的 JavaScript 重定向机制"></a>借助DOM的 JavaScript 重定向机制</h4><p>通常使用 <code>window.location</code> 或 <code>window.location.replace()</code> 方法</p>
<p><code>window.location</code> 通过改变浏览器的地址栏实现重定向，相当于用户点击了浏览器的地址栏并输入新的 URL</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.location = 'https://www.example.com';</span><br></pre></td></tr></tbody></table></figure>

<p><code>window.location.replace()</code> 会将当前页面从浏览器历史记录中移除，并跳转到新页面。它不会在浏览器的历史记录中留下当前页面，因此用户无法通过后退按钮回到当前页面。<strong>相当于无痕模式</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">window.location.replace('https://www.example.com');</span><br></pre></td></tr></tbody></table></figure>

<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><h4 id="域名别称"><a href="#域名别称" class="headerlink" title="域名别称"></a>域名别称</h4><p>扩大站点的用户覆盖面，迁移到新的域名，强制使用HTTPS</p>
<h4 id="保持链接有效"><a href="#保持链接有效" class="headerlink" title="保持链接有效"></a>保持链接有效</h4><p>当你重构 Web 站点的时候，资源的 URL 会发生改变。即便是你更新站点内部的链接来匹配新的 URL，也无法控制被外部资源使用的 URL。你并不想因此而使旧链接失效，因为它们会为你带来宝贵的用户并且帮助优化你的 SEO（搜索引擎优化，是一种通过优化网站和网页内容来提高其在搜索引擎结果页面（SERP）中的排名，从而增加网站的可见性和访问量的技术和策略），所以需要建立从旧链接到新链接的重定向映射</p>
<h4 id="对于不安全请求、耗时请求的临时响应"><a href="#对于不安全请求、耗时请求的临时响应" class="headerlink" title="对于不安全请求、耗时请求的临时响应"></a>对于不安全请求、耗时请求的临时响应</h4><h3 id="配置重定向"><a href="#配置重定向" class="headerlink" title="配置重定向"></a>配置重定向</h3><p>通常，HTTP 重定向是由服务器配置文件（如 Apache 的 <code>.htaccess</code> 或 Nginx 的配置文件）实现的。</p>
<h4 id="在-Apache-中使用-htaccess-文件设置-301-重定向："><a href="#在-Apache-中使用-htaccess-文件设置-301-重定向：" class="headerlink" title="在 Apache 中使用 .htaccess 文件设置 301 重定向："></a>在 <strong>Apache</strong> 中使用 <code>.htaccess</code> 文件设置 301 重定向：</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Redirect 301 /oldpage http://example.com/newpage</span><br></pre></td></tr></tbody></table></figure>

<h4 id="在-Nginx-中设置-301-重定向："><a href="#在-Nginx-中设置-301-重定向：" class="headerlink" title="在 Nginx 中设置 301 重定向："></a>在 <strong>Nginx</strong> 中设置 301 重定向：</h4><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server {</span><br><span class="line">    location /oldpage {</span><br><span class="line">        return 301 http://example.com/newpage;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="HTTP条件请求"><a href="#HTTP条件请求" class="headerlink" title="HTTP条件请求"></a>HTTP条件请求</h2><p>可以用来验证缓存的有效性，省去不必要的控制手段，以及验证文件的完整性，例如在断点续传的场景下或者在上传或者修改服务器端的文件的时候避免更新丢失问题</p>
<blockquote>
<p>[!NOTE]</p>
<p>对于<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Safe/HTTP">安全</a>方法来说，例如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET"><code>GET</code></a>，通常用来获取文件，条件请求可以被用来限定仅在满足条件的情况下返回文件。这样可以节省带宽。</p>
<p>对于<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Safe/HTTP">非安全</a>方法来说，例如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/PUT"><code>PUT</code></a> 方法，通常用来上传文件，条件请求可以被用来限定仅在满足文件的初始版本与服务器上的版本相同的条件下才会将其上传。</p>
</blockquote>
<h3 id="验证器"><a href="#验证器" class="headerlink" title="验证器"></a>验证器</h3><p>在请求中会传递一个描述资源版本的值，这些值称为“验证器”（1.文件的最后修改时间，即 <em>last-modified</em>（最后修改）时间；2.一个意义模糊的字符串，指代一个独一无二的版本，称为“实体标签”，或者 <em>etag</em>）</p>
<p> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified"><code>Last-Modified</code></a> 和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag"><code>ETag</code></a> 首部均可应用于两种验证类型</p>
<h4 id="强验证类型"><a href="#强验证类型" class="headerlink" title="强验证类型"></a>强验证类型</h4><p>应用于需要<strong>逐个字节</strong>相对应的情况，例如需要进行断点续传的时候</p>
<p>通常这是由 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag"><code>ETag</code></a> 首部来完成的，该首部可以提供使用 MD5 算法获取的资源（或其衍生品）的散列值</p>
<h4 id="弱验证类型"><a href="#弱验证类型" class="headerlink" title="弱验证类型"></a>弱验证类型</h4><p>应用于用户代理只需要确认<strong>资源内容相同</strong>即可。即便是有细微差别也可以接受，比如显示的广告不同，或者是页脚的时间不同</p>
<h3 id="条件首部"><a href="#条件首部" class="headerlink" title="条件首部"></a>条件首部</h3><h4 id="If-Match"><a href="#If-Match" class="headerlink" title="If-Match"></a>If-Match</h4><p>如果远端资源的实体标签与在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag"><code>ETag</code></a> 这个首部中列出的值相同的话，表示条件匹配成功。默认地，除非实体标签带有 ‘W/‘ 前缀，否者它将会执行强验证。</p>
<h4 id="If-None-Match"><a href="#If-None-Match" class="headerlink" title="If-None-Match"></a>If-None-Match</h4><p>如果远端资源的实体标签与在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag"><code>ETag</code></a> 这个首部中列出的值都不相同的话，表示条件匹配成功。默认地，除非实体标签带有 ‘W/‘ 前缀，否者它将会执行强验证。</p>
<h4 id="If-Modified-Since-1"><a href="#If-Modified-Since-1" class="headerlink" title="If-Modified-Since"></a>If-Modified-Since</h4><p>如果远端资源的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified"><code>Last-Modified</code></a> 首部标识的日期比在该首部中列出的值要更晚，表示条件匹配成功。</p>
<h4 id="If-Unmodified-Since"><a href="#If-Unmodified-Since" class="headerlink" title="If-Unmodified-Since"></a>If-Unmodified-Since</h4><p>如果远端资源的 HTTPHeader(“Last-Modified”)}} 首部标识的日期比在该首部中列出的值要更早或相同，表示条件匹配成功。</p>
<h4 id="If-Range"><a href="#If-Range" class="headerlink" title="If-Range"></a>If-Range</h4><p>与 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Match"><code>If-Match</code></a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Unmodified-Since"><code>If-Unmodified-Since</code></a> 相似，但是只能含有一个实体标签或者日期值。如果匹配失败，则条件请求宣告失败，此时将不会返回 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/206"><code>206</code></a> <code>Partial Content</code> 响应码，而是返回 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/200"><code>200</code></a> <code>OK</code> 响应码，以及完整的资源。</p>
<h2 id="HTTP范围请求"><a href="#HTTP范围请求" class="headerlink" title="HTTP范围请求"></a>HTTP范围请求</h2><p>HTTP 的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range"><code>Range</code></a> 请求使客户端能够要求服务器仅向其回传 HTTP 消息的一部分。</p>
<p>范围请求对于支持随机访问的媒体播放器、明确只需大型文件某部分的数据处理工具，以及允许用户暂停及恢复下载的下载管理器等客户端尤其有用</p>
<h3 id="检测服务器端是否支持范围请求"><a href="#检测服务器端是否支持范围请求" class="headerlink" title="检测服务器端是否支持范围请求"></a>检测服务器端是否支持范围请求</h3><p>如果 HTTP 响应中存在 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept-Ranges"><code>Accept-Ranges</code></a> 标头：</p>
<p>1.其值不是“<code>none</code>”，那么该服务器支持范围请求。你可以通过使用像 cURL 这样的工具发出一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/HEAD"><code>HEAD</code></a> 请求来进行手动检查</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I http://i.imgur.com/z4d4kWk.jpg</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">…</span><br><span class="line">Accept-Ranges: bytes</span><br><span class="line">Content-Length: 146515</span><br></pre></td></tr></tbody></table></figure>

<p>2.如果网站省略了 <code>Accept-Ranges</code> 标头，那么它们很可能不支持部分请求。有些网站会包含这个标头，但明确将其值设为“<code>none</code>”，以表明它们不支持这一特性</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">…</span><br><span class="line">Accept-Ranges: none</span><br></pre></td></tr></tbody></table></figure>

<p>在这种情况下，下载管理器可能会禁用暂停按钮</p>
<h3 id="从服务器端请求特定的范围"><a href="#从服务器端请求特定的范围" class="headerlink" title="从服务器端请求特定的范围"></a>从服务器端请求特定的范围</h3><p>在 HTTP 请求中包含 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range"><code>Range</code></a> 标头，可以指定希望服务器返回文档的哪一部分或哪些部分</p>
<h4 id="单一范围"><a href="#单一范围" class="headerlink" title="单一范围"></a>单一范围</h4><p>curl的“<code>-H</code>”选项会向请求中添加一个标头，即 <code>Range</code> 标头</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://i.imgur.com/z4d4kWk.jpg -i -H "Range: bytes=0-1023"</span><br></pre></td></tr></tbody></table></figure>

<p>用于请求1024字节</p>
<p>发出请求如下</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /z4d4kWk.jpg HTTP/1.1</span><br><span class="line">Host: i.imgur.com</span><br><span class="line">Range: bytes=0-1023</span><br></pre></td></tr></tbody></table></figure>

<p>服务器将会返回 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/206"><code>206</code></a> <code>Partial Content</code> 状态</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 206 Partial Content</span><br><span class="line">Content-Range: bytes 0-1023/146515</span><br><span class="line">Content-Length: 1024</span><br><span class="line">…</span><br><span class="line">（二进制内容）</span><br></pre></td></tr></tbody></table></figure>

<h4 id="多重范围"><a href="#多重范围" class="headerlink" title="多重范围"></a>多重范围</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range"><code>Range</code></a> 标头还允许在文档中支持一次性获取多重范围。这些范围使用逗号分隔</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://www.example.com -i -H "Range: bytes=0-50, 100-150"</span><br></pre></td></tr></tbody></table></figure>

<p>服务器以 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/206"><code>206</code></a> <code>Partial Content</code> 状态码以及 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a><code>: multipart/byteranges; boundary=3d6b6a416f9b5</code> 标头响应，表明随后的数据将采用多部分字节范围格式。</p>
<p>每个部分都携带自己的 <code>Content-Type</code> 和 <code>Content-Range</code> 字段，而必须的 boundary 参数定义了用于<strong>分割</strong>每个消息体部分的边界字符串</p>
<h4 id="条件式范围请求"><a href="#条件式范围请求" class="headerlink" title="条件式范围请求"></a>条件式范围请求</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Range"><code>If-Range</code></a> HTTP 请求标头使范围请求具有条件性：如果条件兑现，则会发起范围请求，服务器将以包含适当内容主体的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/206"><code>206</code></a> <code>Partial Content</code> 响应进行回复。如果条件不兑现，会被发送完整的资源回来，并带有 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/200"><code>200</code></a> <code>OK</code> 状态。该标头可与 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Last-Modified"><code>Last-Modified</code></a> 验证器或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag"><code>ETag</code></a> 一起使用，但不能同时使用</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">If-Range: Wed, 21 Oct 2015 07:28:00 GMT</span><br></pre></td></tr></tbody></table></figure>

<h3 id="范围请求的响应"><a href="#范围请求的响应" class="headerlink" title="范围请求的响应"></a>范围请求的响应</h3><p> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/206"><code>206</code></a> <code>Partial Content</code> 范围请求成功</p>
<p> <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/416"><code>416</code></a> <code>Requested Range Not Satisfiable</code>超出范围的范围请求</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/200"><code>200</code></a> <code>OK</code>不支持范围请求，并传输完整的响应体</p>
<h2 id="HTTP内容协商"><a href="#HTTP内容协商" class="headerlink" title="HTTP内容协商"></a>HTTP内容协商</h2><p>一种 <strong>HTTP 机制</strong>，它允许客户端和服务器在处理请求时根据客户端的需求和服务器支持的内容来协商返回的资源形式。这种机制通常用在需要提供不同格式、语言、编码或版本的资源时</p>
<h3 id="服务端驱动型"><a href="#服务端驱动型" class="headerlink" title="服务端驱动型"></a>服务端驱动型</h3><p>服务器根据客户端在请求头中提供的信息来决定返回的资源版本</p>
<h4 id="Accept标头"><a href="#Accept标头" class="headerlink" title="Accept标头"></a>Accept标头</h4><p>列举了用户代理希望接收的媒体资源的 MIME 类型（如 <code>text/html</code>, <code>application/json</code>）</p>
<h4 id="Accept-CH标头"><a href="#Accept-CH标头" class="headerlink" title="Accept-CH标头"></a>Accept-CH标头</h4><p>列出了服务器可以用来选择合适响应的配置数据</p>
<table>
<thead>
<tr>
<th align="left">值</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Device-Memory</code></td>
<td align="left">标明客户端设备的内存大小。该值是个估计值，设备的实际内存值会向 2 的次方取整，且除以 1024。比如 512MB 的内存对应的值为 <code>0.5</code>。</td>
</tr>
<tr>
<td align="left"><code>Viewport-Width</code></td>
<td align="left">标明用 CSS 像素数值表示的布局视口（layout viewport）宽度。</td>
</tr>
<tr>
<td align="left"><code>Width</code></td>
<td align="left">标明用物理像素值表示的资源宽度（换句话说就是一张图片的固有大小）。</td>
</tr>
</tbody></table>
<h4 id="Accept-Encoding标头"><a href="#Accept-Encoding标头" class="headerlink" title="Accept-Encoding标头"></a>Accept-Encoding标头</h4><p>说明了（接收端）可以接受的内容编码形式（所支持的压缩算法）（如 <code>gzip</code>, <code>deflate</code>）</p>
<h4 id="Accept-Language标头"><a href="#Accept-Language标头" class="headerlink" title="Accept-Language标头"></a>Accept-Language标头</h4><p>提示用户期望获得的自然语言的优先顺序（如 <code>en-US</code>, <code>zh-CN</code>）</p>
<h4 id="User-Agent标头"><a href="#User-Agent标头" class="headerlink" title="User-Agent标头"></a>User-Agent标头</h4><p>提供客户端的设备信息</p>
<h4 id="Vary响应标头"><a href="#Vary响应标头" class="headerlink" title="Vary响应标头"></a>Vary响应标头</h4><p>用于告诉客户端和代理服务器（如缓存服务器），哪些请求头会影响返回内容的变化</p>
<p>大多数情况下，vary用于在使用内容协商时创建缓存键</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vary: *</span><br><span class="line">Vary: &lt;header-name&gt;, &lt;header-name&gt;, ...</span><br></pre></td></tr></tbody></table></figure>

<p><code>*</code>表示响应因无法确定的原因而改变，禁止缓存此响应</p>
<p><code>&lt;header-name&gt;</code>指影响响应内容的请求头名称，例如 <code>Accept</code>、<code>Accept-Language</code> </p>
<p>如果服务器根据 <code>Accept</code> 请求头返回不同的资源（如 JSON 或 HTML），则应该在响应中添加：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vary: Accept</span><br></pre></td></tr></tbody></table></figure>

<p>如果服务器根据 <code>Accept-Language</code> 返回不同的语言内容：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vary: Accept-Language</span><br></pre></td></tr></tbody></table></figure>

<p>如果服务器根据 <code>Accept-Encoding</code> 提供不同的压缩格式（如 gzip 或 br）：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vary: Accept-Encoding</span><br></pre></td></tr></tbody></table></figure>

<p>如果服务器根据 <code>User-Agent</code> 提供不同的内容（如桌面和移动设备优化）：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vary: User-Agent</span><br></pre></td></tr></tbody></table></figure>

<h3 id="代理驱动型（响应式协商"><a href="#代理驱动型（响应式协商" class="headerlink" title="代理驱动型（响应式协商)"></a>代理驱动型（响应式协商)</h3><p>客户端和服务器通过多次交互来确定最佳资源版本，面临不明确的请求时，服务器会返回一个页面，其中包含了可供选择的资源的链接</p>
<h2 id="HTTP安全"><a href="#HTTP安全" class="headerlink" title="HTTP安全"></a>HTTP安全</h2><h3 id="用户信息安全"><a href="#用户信息安全" class="headerlink" title="用户信息安全"></a>用户信息安全</h3><h4 id="如何关闭表单自动填充"><a href="#如何关闭表单自动填充" class="headerlink" title="如何关闭表单自动填充"></a>如何关闭表单自动填充</h4><p>浏览器能够提供自动补全（在用户开始输入的时候给用户提供可能的内容）和自动填充（在加载的时候预先填充某些字段）功能，但可能涉及用户的隐私，因此浏览器允许用户禁用这些功能</p>
<h5 id="禁止自动补全"><a href="#禁止自动补全" class="headerlink" title="禁止自动补全"></a>禁止自动补全</h5><p>将 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Attributes/autocomplete"><code>autocomplete</code></a> 的属性设置为 “off”</p>
<p>为整个表单设置：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method="post" action="/form" autocomplete="off"&gt;[…]&lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>为表单中某个输入元素单独设置：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method="post" action="/form"&gt;</span><br><span class="line">  […]</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label for="cc"&gt;信用卡：&lt;/label&gt;</span><br><span class="line">    &lt;input type="text" id="cc" name="cc" autocomplete="off" /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>一些浏览器（如 Chrome 和 Edge）即使设置了 <code>autocomplete="off"</code>，仍会尝试为用户名和密码字段提供自动填充功能，那么你需要更改输入元素的 <code>name</code> 属性（浏览器通常会根据字段的 <code>name</code> 属性判断其用途，可以为这些字段设置随机或无意义的 <code>name</code> 值）</p>
<h5 id="autocomplete-属性和登录字段"><a href="#autocomplete-属性和登录字段" class="headerlink" title="autocomplete 属性和登录字段"></a>autocomplete 属性和登录字段</h5><p>如果你定义了一个用户管理页面，其中用户可以为其他人指定新的密码，因此你想阻止密码字段的自动填充，你可以使用 <code>autocomplete="new-password"</code></p>
<h3 id="内容安全"><a href="#内容安全" class="headerlink" title="内容安全"></a>内容安全</h3><h4 id="正确配置服务器-MIME-类型"><a href="#正确配置服务器-MIME-类型" class="headerlink" title="正确配置服务器 MIME 类型"></a>正确配置服务器 MIME 类型</h4><ul>
<li><code>text/html</code>对于一般网页</li>
<li><code>text/plain</code>对于一般文本</li>
<li><code>text/css</code>对于级联样式表</li>
<li><code>text/javascript</code>对于脚本</li>
<li><code>application/octet-stream</code>意味着“下载这个文件”</li>
<li><code>application/x-java-applet</code>对于 Java 小程序</li>
<li><code>application/pdf</code>对于 PDF 文档</li>
</ul>
<h4 id="严格传输安全-HTTP-Strict-Transport-Security-HSTS）"><a href="#严格传输安全-HTTP-Strict-Transport-Security-HSTS）" class="headerlink" title="严格传输安全 (HTTP Strict Transport Security, HSTS）"></a>严格传输安全 (HTTP Strict Transport Security, HSTS）</h4><p>通过强制使用 HTTPS 而非 HTTP 来防止协议降级攻击和会话劫持</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strict-Transport-Security: max-age=&lt;expire-time&gt;[; includeSubDomains][; preload]</span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>max-age</code></strong>: 必须指定，表示 HSTS 策略的有效期（单位：秒）。例如，<code>max-age=31536000</code> 表示策略有效期为 1 年。</p>
<p><strong><code>includeSubDomains</code></strong>: 可选，表示 HSTS 策略适用于主域及其所有子域。</p>
<p>如果设置了该参数，则 <code>sub.example.com</code> 也会强制使用 HTTPS。</p>
<p><strong><code>preload</code></strong>: 可选，指示该域名申请加入浏览器的 HSTS 预加载列表。需要通过 HSTS Preload 提交，当使用 ， 指令必须至少是 （一年），并且必须存在指令</p>
<h4 id="跨源资源共享（CORS）"><a href="#跨源资源共享（CORS）" class="headerlink" title="跨源资源共享（CORS）"></a>跨源资源共享（CORS）</h4><p>一种基于 HTTP 标头的机制，用于允许服务器声明哪些来源（域名）可以访问其资源。它解决了浏览器的 <strong>同源策略</strong> 限制问题，从而安全地实现跨域资源的共享</p>
<h5 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h5><p>请求方法是 <code>GET</code>、<code>POST</code> 或 <code>HEAD</code>。</p>
<p>不包含自定义的请求标头（如 <code>Authorization</code>）。</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type"><code>Content-Type</code></a> 标头所指定的媒体类型的值仅限于下列三者之一：</p>
<ul>
<li><code>application/x-www-form-urlencoded</code></li>
<li><code>multipart/form-data</code></li>
<li><code>text/plain</code></li>
</ul>
<p>浏览器会直接发送请求，并根据响应头判断是否允许访问</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /api/data HTTP/1.1 </span><br><span class="line">Host: api.example.com </span><br><span class="line">Origin: https://example.com</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK </span><br><span class="line">Access-Control-Allow-Origin: https://example.com</span><br></pre></td></tr></tbody></table></figure>

<p>如果 <code>Access-Control-Allow-Origin</code> 标头的值与请求的 <code>Origin</code> 匹配，则浏览器允许访问响应数据</p>
<h5 id="预检请求"><a href="#预检请求" class="headerlink" title="预检请求"></a>预检请求</h5><p>对于非简单请求（如使用 <code>PUT</code>、<code>DELETE</code> 方法，或自定义标头），浏览器会在正式请求之前发送一个 <strong>预检请求</strong>（<code>OPTIONS</code> 请求），以确保服务器允许此操作</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS /api/data HTTP/1.1</span><br><span class="line">Host: api.example.com</span><br><span class="line">Origin: https://example.com</span><br><span class="line">Access-Control-Request-Method: POST</span><br><span class="line">Access-Control-Request-Headers: Authorization</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 204 No Content</span><br><span class="line">Access-Control-Allow-Origin: https://example.com</span><br><span class="line">Access-Control-Allow-Methods: POST, GET, OPTIONS</span><br><span class="line">Access-Control-Allow-Headers: Authorization</span><br><span class="line">Access-Control-Max-Age: 3600</span><br></pre></td></tr></tbody></table></figure>

<p><strong><code>Access-Control-Allow-Origin</code></strong>: 指定允许的来源。</p>
<p><strong><code>Access-Control-Allow-Methods</code></strong>: 列出允许的 HTTP 方法。</p>
<p><strong><code>Access-Control-Allow-Headers</code></strong>: 列出允许的请求标头。</p>
<p><strong><code>Access-Control-Max-Age</code></strong>: 指定预检结果的缓存时间（秒）</p>
<h5 id="带凭据的请求"><a href="#带凭据的请求" class="headerlink" title="带凭据的请求"></a>带凭据的请求</h5><p>如果请求需要发送凭据（如 Cookies 或 HTTP 认证），需要满足以下条件：</p>
<ul>
<li>客户端在请求中设置 <code>withCredentials</code> 为 <code>true</code>。</li>
<li>服务器返回的响应头包含 <code>Access-Control-Allow-Credentials: true</code></li>
</ul>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /api/data HTTP/1.1</span><br><span class="line">Host: api.example.com</span><br><span class="line">Origin: https://example.com</span><br><span class="line">Cookie: sessionId=abc123</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Access-Control-Allow-Origin: https://example.com</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br></pre></td></tr></tbody></table></figure>

<p>如果 <code>Access-Control-Allow-Credentials</code> 为 <code>true</code>，<code>Access-Control-Allow-Origin</code> 必须为具体的来源，不能使用通配符 <code>*</code></p>
<h5 id="HTTP响应标头字段"><a href="#HTTP响应标头字段" class="headerlink" title="HTTP响应标头字段"></a>HTTP响应标头字段</h5><p>1.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Origin"><code>Access-Control-Allow-Origin</code></a> </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Origin: &lt;origin&gt; | *</span><br></pre></td></tr></tbody></table></figure>

<p><code>Access-Control-Allow-Origin</code> 参数指定了单一的源，告诉浏览器允许该源访问资源。或者，对于<strong>不需要携带</strong>身份凭证的请求，服务器可以指定该字段的值为通配符“<code>*</code>”，表示允许来自任意源的请求</p>
<p>2.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Expose-Headers"><code>Access-Control-Expose-Headers</code></a> </p>
<p>跨源访问时，<code>XMLHttpRequest</code> 对象的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/getResponseHeader"><code>getResponseHeader()</code></a> 方法只能拿到一些最基本的响应头，Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma，如果要访问其他头，则需要服务器设置本响应头</p>
<p>将指定标头放入允许列表中，供浏览器的 JavaScript 代码（如 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/getResponseHeader"><code>getResponseHeader()</code></a>）获取</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Expose-Headers: &lt;header-name&gt;[, &lt;header-name&gt;]*</span><br></pre></td></tr></tbody></table></figure>

<p>3.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Max-Age"><code>Access-Control-Max-Age</code></a></p>
<p>指定了 preflight 请求的结果能够被缓存多久</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Max-Age: &lt;delta-seconds&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>4.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials"><code>Access-Control-Allow-Credentials</code></a> </p>
<p>指定了当浏览器的 <code>credentials</code> 设置为 true 时是否允许浏览器读取 response 的内容</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Credentials: true</span><br></pre></td></tr></tbody></table></figure>

<p>5.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Methods"><code>Access-Control-Allow-Methods</code></a> </p>
<p>指定了访问资源时允许使用的请求方法，用于预检请求的响应。其指明了实际请求所允许使用的 HTTP 方法</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Methods: &lt;method&gt;[, &lt;method&gt;]*</span><br></pre></td></tr></tbody></table></figure>

<p>6.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Headers"><code>Access-Control-Allow-Headers</code></a> </p>
<p>用于<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Preflight_request">预检请求</a>的响应。其指明了实际请求中允许携带的标头字段</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Allow-Headers: &lt;header-name&gt;[, &lt;header-name&gt;]*</span><br></pre></td></tr></tbody></table></figure>

<h5 id="HTTP请求标头字段"><a href="#HTTP请求标头字段" class="headerlink" title="HTTP请求标头字段"></a>HTTP请求标头字段</h5><p>1.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Origin"><code>Origin</code></a> </p>
<p>表明预检请求或实际跨源请求的源站</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Origin: &lt;origin&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>origin 参数的值为源站 URL。它不包含任何路径信息，只是服务器名称</p>
<p>2.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Request-Method"><code>Access-Control-Request-Method</code></a> </p>
<p>用于预检请求。其作用是，将实际请求所使用的 HTTP 方法告诉服务器</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Request-Method: &lt;method&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>3.<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Request-Headers"><code>Access-Control-Request-Headers</code></a> </p>
<p>用于预检请求，将实际请求所携带的标头字段（通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/setRequestHeader"><code>setRequestHeader()</code></a> 等设置的）告诉服务器。这个浏览器端标头将由互补的服务器端标头 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Access-Control-Allow-Headers"><code>Access-Control-Allow-Headers</code></a> 回答</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access-Control-Request-Headers: &lt;field-name&gt;[, &lt;field-name&gt;]*</span><br></pre></td></tr></tbody></table></figure>

<h4 id="内容安全策略（CSP）"><a href="#内容安全策略（CSP）" class="headerlink" title="内容安全策略（CSP）"></a><strong>内容安全策略</strong>（CSP）</h4><p>是一个额外的安全层，用于检测并削弱某些特定类型的攻击，包括跨站脚本（XSS）和数据注入攻击等</p>
<p>为使 CSP 可用，你需要配置你的网络服务器返回 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Security-Policy"><code>Content-Security-Policy</code></a> HTTP 标头，除此之外，<code>&lt;meta&gt;</code>元素也可以被用来配置该策略</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://trusted.cdn.com"&gt;</span><br></pre></td></tr></tbody></table></figure>

<h5 id="CSP-示例配置"><a href="#CSP-示例配置" class="headerlink" title="CSP 示例配置"></a><strong>CSP 示例配置</strong></h5><h6 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h6><p>只允许从同源加载资源，禁止内联脚本：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src 'self'; script-src 'self';</span><br></pre></td></tr></tbody></table></figure>

<h6 id="允许可信第三方资源"><a href="#允许可信第三方资源" class="headerlink" title="允许可信第三方资源"></a>允许可信第三方资源</h6><p>允许从指定的 CDN 加载 JavaScript 和样式：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src 'self' https://cdn.example.com; style-src 'self' https://cdn.example.com;</span><br></pre></td></tr></tbody></table></figure>

<h6 id="启用报告机制"><a href="#启用报告机制" class="headerlink" title="启用报告机制"></a>启用报告机制</h6><p>当策略被违反时，将报告发送到指定的 URL：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: default-src 'self'; report-uri /csp-report-endpoint;</span><br></pre></td></tr></tbody></table></figure>

<h6 id="防止-iframe-嵌套"><a href="#防止-iframe-嵌套" class="headerlink" title="防止 iframe 嵌套"></a>防止 iframe 嵌套</h6><p>禁止页面被嵌套在 <code>&lt;iframe&gt;</code> 中，防止点击劫持攻击：</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: frame-ancestors 'none';</span><br></pre></td></tr></tbody></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20250122092258684.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="https://raw.githubusercontent.com/zkk1233/Picture/main/20250122092258689.png" alt="屏幕截图 2025-01-22 092240"></p>
<h3 id="X-框架选项"><a href="#X-框架选项" class="headerlink" title="X 框架选项"></a>X 框架选项</h3><p>‘’’</p>
<h2 id="HTTP标头"><a href="#HTTP标头" class="headerlink" title="HTTP标头"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers">HTTP标头</a></h2></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://zkk1233.github.io">hackun</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://zkk1233.github.io/2024/10/15/HTTP/">https://zkk1233.github.io/2024/10/15/HTTP/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://zkk1233.github.io" target="_blank">无言の小屋</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/img/hh.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer=""></script></div></div><nav class="pagination-post" id="pagination"><a class="prev-post pull-left" href="/2024/10/15/JavaScript/" title="JavaScript"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JavaScript</div></div></a><a class="next-post pull-right" href="/2024/10/10/hello-world/" title="Hello World"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Hello World</div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/gg.gif" data-original="/img/hh.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"></div><div class="author-info-name">hackun</div><div class="author-info-description">在谷底也要开花，在海底也要望月</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">12</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow me,please!</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">在绝望中寻找光明！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP"><span class="toc-number">1.</span> <span class="toc-text">HTTP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">HTTP概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82%E5%8C%85%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">HTTP请求包的结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E8%A1%8C"><span class="toc-number">1.2.1.</span> <span class="toc-text">请求行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#URL"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">URL</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#URL%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.1.1.1.</span> <span class="toc-text">URL基本内容</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%EF%BC%88scheme%EF%BC%89"><span class="toc-number">1.2.1.1.1.1.</span> <span class="toc-text">协议（scheme）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9D%83%E5%A8%81%EF%BC%88authority%EF%BC%89"><span class="toc-number">1.2.1.1.1.2.</span> <span class="toc-text">权威（authority）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%EF%BC%88Path%EF%BC%89"><span class="toc-number">1.2.1.1.1.3.</span> <span class="toc-text">路径（Path）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%EF%BC%88Parameters%EF%BC%89"><span class="toc-number">1.2.1.1.1.4.</span> <span class="toc-text">参数（Parameters）</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%94%9A%E7%82%B9%EF%BC%88Anchor%EF%BC%89"><span class="toc-number">1.2.1.1.1.5.</span> <span class="toc-text">锚点（Anchor）</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E4%BA%9BURL"><span class="toc-number">1.2.1.1.2.</span> <span class="toc-text">一些URL</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">请求方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%96%B9%E5%BC%8F%EF%BC%9A"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">请求方式：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#GET%E5%92%8CPOST"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">GET和POST</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#get-%E8%AF%B7%E6%B1%82"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">get 请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#post%E8%AF%B7%E6%B1%82"><span class="toc-number">1.2.2.2.2.</span> <span class="toc-text">post请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#get%E5%92%8Cpost%E5%8C%BA%E5%88%AB"><span class="toc-number">1.2.2.2.3.</span> <span class="toc-text">get和post区别</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#get-%E5%92%8C-post-%E8%AF%B7%E6%B1%82%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.2.2.4.</span> <span class="toc-text">get 和 post 请求的使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#get"><span class="toc-number">1.2.2.2.4.1.</span> <span class="toc-text">get</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#post"><span class="toc-number">1.2.2.2.4.2.</span> <span class="toc-text">post</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%8F%8A%E5%85%B6%E5%86%85%E5%AE%B9"><span class="toc-number">1.2.3.</span> <span class="toc-text">请求头及其内容</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%B4%E5%8F%8A%E4%BD%9C%E7%94%A8"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">常见的请求头及作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP-%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">HTTP 基本认证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E5%93%8D%E5%BA%94%E5%8C%85%E7%9A%84%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.</span> <span class="toc-text">HTTP响应包的结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.</span> <span class="toc-text">HTTP缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.1.</span> <span class="toc-text">私有缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B1%E4%BA%AB%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.2.</span> <span class="toc-text">共享缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">代理缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%98%E7%AE%A1%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">托管缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8F%91%E5%BC%8F%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.3.</span> <span class="toc-text">启发式缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E-age-%E7%9A%84%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-number">1.4.4.</span> <span class="toc-text">基于 age 的缓存策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vary%E5%93%8D%E5%BA%94"><span class="toc-number">1.4.5.</span> <span class="toc-text">Vary响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%93%8D%E5%BA%94"><span class="toc-number">1.4.6.</span> <span class="toc-text">验证响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-Modified-Since"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">If-Modified-Since</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ETag-If-None-Match"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">ETag/If-None-Match</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E9%87%8D%E6%96%B0%E9%AA%8C%E8%AF%81"><span class="toc-number">1.4.6.3.</span> <span class="toc-text">强制重新验证</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-number">1.4.7.</span> <span class="toc-text">不使用缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%BC%BA%E5%88%B6%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.4.8.</span> <span class="toc-text">重新加载和强制重新加载</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.4.8.1.</span> <span class="toc-text">重新加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E5%88%B6%E9%87%8D%E6%96%B0%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.4.8.2.</span> <span class="toc-text">强制重新加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%81%BF%E5%85%8D%E9%87%8D%E6%96%B0%E9%AA%8C%E8%AF%81"><span class="toc-number">1.4.8.3.</span> <span class="toc-text">避免重新验证</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.5.</span> <span class="toc-text">HTTP重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B0%B8%E4%B9%85%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.5.1.</span> <span class="toc-text">永久重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%B4%E6%97%B6%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.5.2.</span> <span class="toc-text">临时重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.5.3.</span> <span class="toc-text">特殊重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%90%91%E9%87%8D%E5%AE%9A%E5%90%91%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E5%BC%8F"><span class="toc-number">1.5.4.</span> <span class="toc-text">指向重定向的其他方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML%E9%87%8D%E5%AE%9A%E5%90%91%E6%9C%BA%E5%88%B6"><span class="toc-number">1.5.4.1.</span> <span class="toc-text">HTML重定向机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%80%9F%E5%8A%A9DOM%E7%9A%84-JavaScript-%E9%87%8D%E5%AE%9A%E5%90%91%E6%9C%BA%E5%88%B6"><span class="toc-number">1.5.4.2.</span> <span class="toc-text">借助DOM的 JavaScript 重定向机制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.5.5.</span> <span class="toc-text">应用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%9F%E5%90%8D%E5%88%AB%E7%A7%B0"><span class="toc-number">1.5.5.1.</span> <span class="toc-text">域名别称</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E6%8C%81%E9%93%BE%E6%8E%A5%E6%9C%89%E6%95%88"><span class="toc-number">1.5.5.2.</span> <span class="toc-text">保持链接有效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E4%BA%8E%E4%B8%8D%E5%AE%89%E5%85%A8%E8%AF%B7%E6%B1%82%E3%80%81%E8%80%97%E6%97%B6%E8%AF%B7%E6%B1%82%E7%9A%84%E4%B8%B4%E6%97%B6%E5%93%8D%E5%BA%94"><span class="toc-number">1.5.5.3.</span> <span class="toc-text">对于不安全请求、耗时请求的临时响应</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">1.5.6.</span> <span class="toc-text">配置重定向</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-Apache-%E4%B8%AD%E4%BD%BF%E7%94%A8-htaccess-%E6%96%87%E4%BB%B6%E8%AE%BE%E7%BD%AE-301-%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%9A"><span class="toc-number">1.5.6.1.</span> <span class="toc-text">在 Apache 中使用 .htaccess 文件设置 301 重定向：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-Nginx-%E4%B8%AD%E8%AE%BE%E7%BD%AE-301-%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%9A"><span class="toc-number">1.5.6.2.</span> <span class="toc-text">在 Nginx 中设置 301 重定向：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E6%9D%A1%E4%BB%B6%E8%AF%B7%E6%B1%82"><span class="toc-number">1.6.</span> <span class="toc-text">HTTP条件请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="toc-number">1.6.1.</span> <span class="toc-text">验证器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%BA%E9%AA%8C%E8%AF%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">强验证类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%B1%E9%AA%8C%E8%AF%81%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">弱验证类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E9%A6%96%E9%83%A8"><span class="toc-number">1.6.2.</span> <span class="toc-text">条件首部</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#If-Match"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">If-Match</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#If-None-Match"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">If-None-Match</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#If-Modified-Since-1"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">If-Modified-Since</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#If-Unmodified-Since"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">If-Unmodified-Since</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#If-Range"><span class="toc-number">1.6.2.5.</span> <span class="toc-text">If-Range</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E8%8C%83%E5%9B%B4%E8%AF%B7%E6%B1%82"><span class="toc-number">1.7.</span> <span class="toc-text">HTTP范围请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81%E8%8C%83%E5%9B%B4%E8%AF%B7%E6%B1%82"><span class="toc-number">1.7.1.</span> <span class="toc-text">检测服务器端是否支持范围请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E7%89%B9%E5%AE%9A%E7%9A%84%E8%8C%83%E5%9B%B4"><span class="toc-number">1.7.2.</span> <span class="toc-text">从服务器端请求特定的范围</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E8%8C%83%E5%9B%B4"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">单一范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E9%87%8D%E8%8C%83%E5%9B%B4"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">多重范围</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%BC%8F%E8%8C%83%E5%9B%B4%E8%AF%B7%E6%B1%82"><span class="toc-number">1.7.2.3.</span> <span class="toc-text">条件式范围请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E8%AF%B7%E6%B1%82%E7%9A%84%E5%93%8D%E5%BA%94"><span class="toc-number">1.7.3.</span> <span class="toc-text">范围请求的响应</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-number">1.8.</span> <span class="toc-text">HTTP内容协商</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E9%A9%B1%E5%8A%A8%E5%9E%8B"><span class="toc-number">1.8.1.</span> <span class="toc-text">服务端驱动型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Accept%E6%A0%87%E5%A4%B4"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">Accept标头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Accept-CH%E6%A0%87%E5%A4%B4"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">Accept-CH标头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Accept-Encoding%E6%A0%87%E5%A4%B4"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">Accept-Encoding标头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Accept-Language%E6%A0%87%E5%A4%B4"><span class="toc-number">1.8.1.4.</span> <span class="toc-text">Accept-Language标头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#User-Agent%E6%A0%87%E5%A4%B4"><span class="toc-number">1.8.1.5.</span> <span class="toc-text">User-Agent标头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Vary%E5%93%8D%E5%BA%94%E6%A0%87%E5%A4%B4"><span class="toc-number">1.8.1.6.</span> <span class="toc-text">Vary响应标头</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E9%A9%B1%E5%8A%A8%E5%9E%8B%EF%BC%88%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8D%8F%E5%95%86"><span class="toc-number">1.8.2.</span> <span class="toc-text">代理驱动型（响应式协商)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E5%AE%89%E5%85%A8"><span class="toc-number">1.9.</span> <span class="toc-text">HTTP安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8"><span class="toc-number">1.9.1.</span> <span class="toc-text">用户信息安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%AD%E8%A1%A8%E5%8D%95%E8%87%AA%E5%8A%A8%E5%A1%AB%E5%85%85"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">如何关闭表单自动填充</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A6%81%E6%AD%A2%E8%87%AA%E5%8A%A8%E8%A1%A5%E5%85%A8"><span class="toc-number">1.9.1.1.1.</span> <span class="toc-text">禁止自动补全</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#autocomplete-%E5%B1%9E%E6%80%A7%E5%92%8C%E7%99%BB%E5%BD%95%E5%AD%97%E6%AE%B5"><span class="toc-number">1.9.1.1.2.</span> <span class="toc-text">autocomplete 属性和登录字段</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8"><span class="toc-number">1.9.2.</span> <span class="toc-text">内容安全</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AD%A3%E7%A1%AE%E9%85%8D%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8-MIME-%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">正确配置服务器 MIME 类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A5%E6%A0%BC%E4%BC%A0%E8%BE%93%E5%AE%89%E5%85%A8-HTTP-Strict-Transport-Security-HSTS%EF%BC%89"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">严格传输安全 (HTTP Strict Transport Security, HSTS）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E6%BA%90%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB%EF%BC%88CORS%EF%BC%89"><span class="toc-number">1.9.2.3.</span> <span class="toc-text">跨源资源共享（CORS）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82"><span class="toc-number">1.9.2.3.1.</span> <span class="toc-text">简单请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82"><span class="toc-number">1.9.2.3.2.</span> <span class="toc-text">预检请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%A6%E5%87%AD%E6%8D%AE%E7%9A%84%E8%AF%B7%E6%B1%82"><span class="toc-number">1.9.2.3.3.</span> <span class="toc-text">带凭据的请求</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP%E5%93%8D%E5%BA%94%E6%A0%87%E5%A4%B4%E5%AD%97%E6%AE%B5"><span class="toc-number">1.9.2.3.4.</span> <span class="toc-text">HTTP响应标头字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82%E6%A0%87%E5%A4%B4%E5%AD%97%E6%AE%B5"><span class="toc-number">1.9.2.3.5.</span> <span class="toc-text">HTTP请求标头字段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%EF%BC%88CSP%EF%BC%89"><span class="toc-number">1.9.2.4.</span> <span class="toc-text">内容安全策略（CSP）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CSP-%E7%A4%BA%E4%BE%8B%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.2.4.1.</span> <span class="toc-text">CSP 示例配置</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-number">1.9.2.4.1.1.</span> <span class="toc-text">基本配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%85%81%E8%AE%B8%E5%8F%AF%E4%BF%A1%E7%AC%AC%E4%B8%89%E6%96%B9%E8%B5%84%E6%BA%90"><span class="toc-number">1.9.2.4.1.2.</span> <span class="toc-text">允许可信第三方资源</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%90%AF%E7%94%A8%E6%8A%A5%E5%91%8A%E6%9C%BA%E5%88%B6"><span class="toc-number">1.9.2.4.1.3.</span> <span class="toc-text">启用报告机制</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%98%B2%E6%AD%A2-iframe-%E5%B5%8C%E5%A5%97"><span class="toc-number">1.9.2.4.1.4.</span> <span class="toc-text">防止 iframe 嵌套</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#X-%E6%A1%86%E6%9E%B6%E9%80%89%E9%A1%B9"><span class="toc-number">1.9.3.</span> <span class="toc-text">X 框架选项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E6%A0%87%E5%A4%B4"><span class="toc-number">1.10.</span> <span class="toc-text">HTTP标头</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/07/CRLF%E6%BC%8F%E6%B4%9E/" title="CRLF漏洞">CRLF漏洞</a><time datetime="2025-02-07T14:00:58.664Z" title="发表于 2025-02-07 22:00:58">2025-02-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/05/XSS%E6%BC%8F%E6%B4%9E/" title="XSS漏洞">XSS漏洞</a><time datetime="2025-02-05T12:49:35.428Z" title="发表于 2025-02-05 20:49:35">2025-02-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/05/SQL%E6%B3%A8%E5%85%A5/" title="SQL注入">SQL注入</a><time datetime="2025-02-05T02:21:14.767Z" title="发表于 2025-02-05 10:21:14">2025-02-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/05/php/" title="PHP">PHP</a><time datetime="2025-02-05T02:21:14.766Z" title="发表于 2025-02-05 10:21:14">2025-02-05</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/02/05/MySQL/" title="MySQL">MySQL</a><time datetime="2025-02-05T02:21:14.764Z" title="发表于 2025-02-05 10:21:14">2025-02-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">©2019 - 2025 By hackun</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="nav-music"><div id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()">播放音乐</div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>(() => {
  const panguFn = () => {
    if (typeof pangu === 'object') pangu.autoSpacingPage()
    else {
      btf.getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
        .then(() => {
          pangu.autoSpacingPage()
        })
    }
  }

  const panguInit = () => {
    if (false){
      GLOBAL_CONFIG_SITE.isPost && panguFn()
    } else {
      panguFn()
    }
  }

  btf.addGlobalFn('pjaxComplete', panguInit, 'pangu')
  document.addEventListener('DOMContentLoaded', panguInit)
})()</script><div class="js-pjax"><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoovercel-theta.vercel.app',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoovercel-theta.vercel.app',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script>window.newestComments = {
  changeContent: content => {
    if (content === '') return content

    content = content.replace(/<img.*?src="/img/gg.gif" data-original="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<code>.*?<\/code>/gi, '[代码]') // replace code      
    content = content.replace(/<[^>]+>/g, "") // remove html tag

    if (content.length > 150) {
      content = content.substring(0, 150) + '...'
    }
    return content
  },

  generateHtml: (array, ele) => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class="aside-list-item">'

        if (true && array[i].avatar) {
          const imgAttr = 'data-lazy-src'
          result += `<a href="${array[i].url}" class="thumbnail"><img ${imgAttr}="${array[i].avatar}" alt="${array[i].nick}"></a>`
        }

        result += `<div class="content">
        <a class="comment" href="${array[i].url}" title="${array[i].content}">${array[i].content}</a>
        <div class="name"><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '暂无评论'
    }

    ele.innerHTML = result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh(ele)
  },

  newestCommentInit: (name, getComment) => {
    const $dom = document.querySelector('#card-newest-comments .aside-list')
    if ($dom) {
      const data = btf.saveToLocal.get(name)
      if (data) {
        newestComments.generateHtml(JSON.parse(data), $dom)
      } else {
        getComment($dom)
      }
    }
  },

  run: (name, getComment) => {
    newestComments.newestCommentInit(name, getComment)
    btf.addGlobalFn('pjaxComplete', () => newestComments.newestCommentInit(name, getComment), name)
  }
}</script><script>window.addEventListener('load', () => {
  const keyName = 'twikoo-newest-comments'
  const { changeContent, generateHtml, run } = window.newestComments

  const getComment = ele => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoovercel-theta.vercel.app',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(res => {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        btf.saveToLocal.set(keyName, JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray, ele)
      }).catch(err => {
        console.error(err)
        ele.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  run(keyName, getComment)
})</script><script src="//at.alicdn.com/t/c/font_4824591_9azdcw4711i.js"></script><script src="/js/nav_menu.js" data-pjax=""></script><script src="/js/cursor.js"></script><script defer="" src="/js/bubble.js"></script><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><script async="" data-pjax="" src="/js/music_2.js"></script><script async="" src="/js/music_1.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="无言,の,小屋" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://npm.elemecdn.com/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      pjax.loadUrl('/404.html')
    }
  })
})()</script><script async="" data-pjax="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div>
    <link rel="stylesheet" href="https://ai.tianli0.top/static/public/postChatUser_summary.min.css">
    <script>
        let tianliGPT_key = 'c46527b108ef5a7a1f8607eae3dcbea16c2fef16';
        let tianliGPT_postSelector = '#postchat_postcontent';
        let tianliGPT_Title = '文章摘要';
        let tianliGPT_postURL = '/^https?://[^/]+/[0-9]{4}/[0-9]{2}/[0-9]{2}/';
        let tianliGPT_blacklist = '';
        let tianliGPT_wordLimit = '1000';
        let tianliGPT_typingAnimate = true;
        let tianliGPT_theme = 'default';
        var postChatConfig = {
          backgroundColor: "#3e86f6",
          bottom: "64px",
          left: "32px",
          fill: "#FFFFFF",
          width: "66px",
          frameWidth: "375px",
          frameHeight: "600px",
          defaultInput: true,
          upLoadWeb: true,
          showInviteLink: true,
          userTitle: "PostChat",
          userDesc: "如果你对网站的内容有任何疑问，可以来问我哦～",
          addButton: true,
          beginningText: "这篇文章介绍了",
          userIcon: "https://ai.tianli0.top/static/img/PostChat.webp",
          userMode: "magic",
          defaultChatQuestions: ["你好","你是谁"],
          defaultSearchQuestions: ["视频压缩","设计"]
        };
    </script>
    <script data-postchat_key="c46527b108ef5a7a1f8607eae3dcbea16c2fef16" src="https://ai.tianli0.top/static/public/postChatUser_summary.min.js"></script>
  
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":15,"vOffset":-20},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>